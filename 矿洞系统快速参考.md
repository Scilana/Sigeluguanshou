# çŸ¿æ´ç³»ç»Ÿå¿«é€Ÿå‚è€ƒ

## ğŸ“‚ æ–°å¢æ–‡ä»¶æ¸…å•

### C++ ä»£ç æ–‡ä»¶
```
Classes/
â”œâ”€â”€ MineScene.h          - çŸ¿æ´åœºæ™¯å¤´æ–‡ä»¶
â”œâ”€â”€ MineScene.cpp        - çŸ¿æ´åœºæ™¯å®ç°
â”œâ”€â”€ MineLayer.h          - çŸ¿æ´åœ°å›¾å±‚å¤´æ–‡ä»¶
â”œâ”€â”€ MineLayer.cpp        - çŸ¿æ´åœ°å›¾å±‚å®ç°
â”œâ”€â”€ MiningManager.h      - æŒ–çŸ¿ç®¡ç†å™¨å¤´æ–‡ä»¶
â””â”€â”€ MiningManager.cpp    - æŒ–çŸ¿ç®¡ç†å™¨å®ç°
```

### èµ„æºæ–‡ä»¶ï¼ˆéœ€è¦ä½ åˆ›å»ºï¼‰
```
Resources/map/
â”œâ”€â”€ mine_floor1.tmx      - ç¬¬1å±‚çŸ¿æ´åœ°å›¾ï¼ˆTMX æ ¼å¼ï¼‰
â”œâ”€â”€ mine_floor.png       - åœ°é¢ç“¦ç‰‡å›¾é›†
â”œâ”€â”€ mine_walls.png       - å¢™å£ç“¦ç‰‡å›¾é›†
â”œâ”€â”€ mine_minerals.png    - çŸ¿ç‰©ç“¦ç‰‡å›¾é›†
â””â”€â”€ mine_stairs.png      - æ¥¼æ¢¯ç“¦ç‰‡å›¾é›†
```

### é…ç½®æ–‡ä»¶
```
CMakeLists.txt           - å·²æ›´æ–°ï¼ˆæ·»åŠ äº†çŸ¿æ´ç›¸å…³æ–‡ä»¶ï¼‰
```

---

## ğŸ® æ¸¸æˆæ“ä½œ

### çŸ¿æ´å†…æ“ä½œ
| æŒ‰é”® | åŠŸèƒ½ |
|------|------|
| **WASD** | ç§»åŠ¨ç©å®¶ |
| **J** | æŒ–æ˜çŸ¿ç‰© |
| **B** | æ‰“å¼€èƒŒåŒ… |
| **Enter** | åœ¨æ¥¼æ¢¯ä¸ŠæŒ‰ä¸‹è¿›å…¥ä¸‹ä¸€å±‚ |
| **ESC** | è¿”å›å†œåœºï¼ˆéœ€è¦ä½ å®ç°ï¼‰ |

---

## ğŸ—ºï¸ TMX åœ°å›¾å›¾å±‚ç»“æ„

### å¿…é¡»çš„å›¾å±‚ï¼ˆåç§°ä¸¥æ ¼åŒºåˆ†å¤§å°å†™ï¼‰

| å›¾å±‚åç§° | ç±»å‹ | ç”¨é€” | æ˜¯å¦å¯è§ |
|---------|------|------|---------|
| **base** | Tile Layer | åœ°é¢çº¹ç† | âœ… |
| **collision** | Tile Layer | å¢™å£ã€éšœç¢ç‰© | âŒï¼ˆä»£ç è‡ªåŠ¨éšè—ï¼‰ |
| **mineral** | Tile Layer | å¯æŒ–æ˜çš„çŸ¿ç‰© | âœ… |
| **stairs** | Tile Layer | ä¸‹æ¥¼æ¢¯ | âœ… |

### å›¾å±‚é¡ºåºï¼ˆä»ä¸‹åˆ°ä¸Šï¼‰
```
[é¡¶å±‚] stairs
       mineral
       collision
[åº•å±‚] base
```

---

## âš™ï¸ ä»£ç é›†æˆè¦ç‚¹

### 1. ä» GameScene è¿›å…¥çŸ¿æ´

åœ¨ `GameScene.h` ä¸­æ·»åŠ ï¼š
```cpp
#include "MineScene.h"

private:
    void enterMine();
```

åœ¨ `GameScene.cpp` ä¸­å®ç°ï¼š
```cpp
void GameScene::enterMine()
{
    auto mineScene = MineScene::createScene(inventory_, 1);  // 1 = ç¬¬1å±‚
    Director::getInstance()->replaceScene(TransitionFade::create(1.0f, mineScene));
}
```

åœ¨ `GameScene::onKeyPressed()` ä¸­æ·»åŠ ï¼š
```cpp
case EventKeyboard::KeyCode::KEY_M:
    enterMine();
    break;
```

### 2. ä»çŸ¿æ´è¿”å›å†œåœº

åœ¨ `MineScene.cpp` çš„ `backToFarm()` ä¸­ä¿®æ”¹ï¼š
```cpp
void MineScene::backToFarm()
{
    // éœ€è¦åˆ›å»ºä¸€ä¸ªèƒ½æ¥å— inventory å‚æ•°çš„ GameScene
    // æ–¹æ¡ˆ 1ï¼šä¿®æ”¹ GameScene::createScene æ¥å— inventory
    // æ–¹æ¡ˆ 2ï¼šä½¿ç”¨å•ä¾‹æ¨¡å¼ç®¡ç† inventory

    auto farmScene = GameScene::createScene();  // éœ€è¦ä¿®æ”¹
    Director::getInstance()->replaceScene(TransitionFade::create(1.0f, farmScene));
}
```

### 3. é…ç½®çŸ¿ç‰© GID

åœ¨ `MiningManager.cpp` çš„ `initMineralDefs()` ä¸­ä¿®æ”¹ GID å€¼ï¼š

```cpp
// ç¤ºä¾‹ GIDï¼Œæ ¹æ®ä½ çš„ tileset å®é™…å€¼ä¿®æ”¹
mineralDefs_[1002] = MineralDef{
    1002,               // GIDï¼ˆåœ¨ Tiled ä¸­æŸ¥çœ‹ï¼‰
    "Copper Ore",       // åç§°
    3,                  // éœ€è¦æ•²å‡»æ¬¡æ•°
    ItemType::Wood,     // æ‰è½ç‰©å“ç±»å‹ï¼ˆä¸´æ—¶ä½¿ç”¨ Woodï¼‰
    1, 3,               // æ‰è½æ•°é‡èŒƒå›´ï¼ˆ1-3ä¸ªï¼‰
    5                   // ç»éªŒå¥–åŠ±
};
```

**å¦‚ä½•æŸ¥æ‰¾ GIDï¼š**
1. åœ¨ Tiled ä¸­é€‰æ‹©çŸ¿ç‰©å±‚
2. ç‚¹å‡»ä¸€ä¸ªçŸ¿ç‰©ç“¦ç‰‡
3. æŸ¥çœ‹å±æ€§é¢æ¿ä¸­çš„ GID å€¼

---

## ğŸ› ï¸ å¿«é€Ÿåˆ¶ä½œåœ°å›¾æ­¥éª¤

### Step 1: åˆ›å»ºæ–°åœ°å›¾
1. æ‰“å¼€ Tiled
2. æ–°å»ºåœ°å›¾ï¼š40x30 ç“¦ç‰‡ï¼Œ32x32 åƒç´ 
3. ä¿å­˜ä¸º `mine_floor1.tmx`

### Step 2: æ·»åŠ ç“¦ç‰‡é›†
1. åœ°å›¾ â†’ æ–°å»ºç“¦ç‰‡é›†
2. æ·»åŠ  4 ä¸ªç“¦ç‰‡é›†ï¼š
   - mine_floor (åœ°é¢)
   - mine_walls (å¢™å£)
   - mine_minerals (çŸ¿ç‰©)
   - mine_stairs (æ¥¼æ¢¯)

### Step 3: åˆ›å»ºå›¾å±‚
1. æ·»åŠ  `base` å±‚ï¼Œç»˜åˆ¶åœ°é¢
2. æ·»åŠ  `collision` å±‚ï¼Œç»˜åˆ¶å¢™å£
3. æ·»åŠ  `mineral` å±‚ï¼Œæ”¾ç½®çŸ¿ç‰©
4. æ·»åŠ  `stairs` å±‚ï¼Œæ”¾ç½®æ¥¼æ¢¯

### Step 4: ä¿å­˜å¹¶æµ‹è¯•
1. ä¿å­˜åœ°å›¾åˆ° `Resources/map/`
2. ç¼–è¯‘æ¸¸æˆ
3. æŒ‰ M é”®è¿›å…¥çŸ¿æ´æµ‹è¯•

---

## ğŸ› å¸¸è§é”™è¯¯åŠè§£å†³

### é”™è¯¯ 1: "Failed to load mine map"

**åŸå› **ï¼šåœ°å›¾æ–‡ä»¶ä¸å­˜åœ¨æˆ–è·¯å¾„é”™è¯¯

**è§£å†³**ï¼š
- æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åœ¨ `Resources/map/mine_floor1.tmx`
- ç¡®ä¿æ–‡ä»¶åå’Œä»£ç ä¸­çš„ä¸€è‡´

### é”™è¯¯ 2: å›¾å±‚æœªæ‰¾åˆ°è­¦å‘Š

**åŸå› **ï¼šå›¾å±‚åç§°æ‹¼å†™é”™è¯¯

**è§£å†³**ï¼š
- åœ¨ Tiled ä¸­æ£€æŸ¥å›¾å±‚åç§°
- å¿…é¡»å®Œå…¨åŒ¹é…ï¼š`base`, `collision`, `mineral`, `stairs`

### é”™è¯¯ 3: ç©å®¶å¯ä»¥ç©¿å¢™

**åŸå› **ï¼šcollision å±‚æœªæ­£ç¡®è®¾ç½®

**è§£å†³**ï¼š
- åœ¨ Tiled ä¸­æ£€æŸ¥ collision å±‚æ˜¯å¦æœ‰ç“¦ç‰‡
- ç¡®ä¿å¢™å£ä½ç½®æœ‰å†…å®¹

### é”™è¯¯ 4: æŒ–çŸ¿æ— ååº”

**åŸå› **ï¼šçŸ¿ç‰© GID ä¸åŒ¹é…

**è§£å†³**ï¼š
- åœ¨ Tiled ä¸­æŸ¥çœ‹çŸ¿ç‰©çš„å®é™… GID
- æ›´æ–° `MiningManager::initMineralDefs()` ä¸­çš„ GID

---

## ğŸ“Š ç±»å…³ç³»å›¾

```
MineScene (åœºæ™¯)
â”œâ”€â”€ MineLayer (åœ°å›¾å±‚)
â”‚   â””â”€â”€ TMXTiledMap (Cocos2d-x åœ°å›¾)
â”‚       â”œâ”€â”€ base (åŸºç¡€å±‚)
â”‚       â”œâ”€â”€ collision (ç¢°æ’å±‚)
â”‚       â”œâ”€â”€ mineral (çŸ¿ç‰©å±‚)
â”‚       â””â”€â”€ stairs (æ¥¼æ¢¯å±‚)
â”œâ”€â”€ MiningManager (æŒ–çŸ¿ç®¡ç†)
â”‚   â””â”€â”€ MineralDef (çŸ¿ç‰©å®šä¹‰)
â”œâ”€â”€ Player (ç©å®¶)
â””â”€â”€ InventoryManager (èƒŒåŒ… - å…±äº«)
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥æ‰©å±•å»ºè®®

### 1. æ·»åŠ æ–°çŸ¿ç‰©ç±»å‹
åœ¨ `InventoryManager.h` ä¸­æ·»åŠ æ–°çš„ `ItemType`ï¼š
```cpp
enum class ItemType {
    // ... ç°æœ‰ç±»å‹
    CopperOre,
    IronOre,
    GoldOre,
    Gemstone
};
```

### 2. æ·»åŠ ä½“åŠ›ç³»ç»Ÿ
- æŒ–çŸ¿æ¶ˆè€—ä½“åŠ›
- ä½“åŠ›ä¸º 0 æ—¶è‡ªåŠ¨è¿”å›åœ°é¢
- åƒé£Ÿç‰©æ¢å¤ä½“åŠ›

### 3. æ·»åŠ æ€ªç‰©ç³»ç»Ÿ
- åˆ›å»º `Monster` ç±»
- åœ¨çŸ¿æ´ä¸­éšæœºç”Ÿæˆ
- æˆ˜æ–—æ‰è½ç‰©å“

### 4. æ·»åŠ å•†åº—ç³»ç»Ÿ
- å‡ºå”®æŒ–åˆ°çš„çŸ¿çŸ³
- è´­ä¹°æ›´å¥½çš„é•å­
- å‡çº§å·¥å…·

### 5. éšæœºåœ°å›¾ç”Ÿæˆ
- ä½¿ç”¨ç®—æ³•åŠ¨æ€ç”ŸæˆçŸ¿æ´
- æ¯æ¬¡è¿›å…¥éƒ½ä¸åŒ
- å¢åŠ å¯ç©æ€§

---

## ğŸ“ ä»£ç æ£€æŸ¥æ¸…å•

ç¼–è¯‘å‰è¯·ç¡®è®¤ï¼š

- [ ] æ‰€æœ‰ `.h` å’Œ `.cpp` æ–‡ä»¶å·²åˆ›å»º
- [ ] `CMakeLists.txt` å·²æ›´æ–°
- [ ] `mine_floor1.tmx` å·²æ”¾ç½®åœ¨ `Resources/map/`
- [ ] ç“¦ç‰‡å›¾é›† PNG æ–‡ä»¶å·²æ”¾ç½®åœ¨ `Resources/map/`
- [ ] çŸ¿ç‰© GID å·²åœ¨ `MiningManager.cpp` ä¸­é…ç½®
- [ ] GameScene ä¸­æ·»åŠ äº† `enterMine()` å‡½æ•°
- [ ] é”®ç›˜ç›‘å¬ä¸­æ·»åŠ äº† M é”®è§¦å‘çŸ¿æ´

---

## ğŸ¨ æ¨èèµ„æº

### Tileset èµ„æºç½‘ç«™
- **OpenGameArt**: https://opengameart.org/
- **Itch.io**: https://itch.io/game-assets/free
- **Kenney**: https://kenney.nl/assets

### æœç´¢å…³é”®è¯
- "mine tileset 32x32"
- "cave tiles"
- "dungeon tileset"
- "ore sprites"

---

## ğŸ“– å®Œæ•´æ–‡æ¡£

è¯¦ç»†çš„åœ°å›¾åˆ¶ä½œæ­¥éª¤è¯·æŸ¥çœ‹ï¼š
**[çŸ¿æ´åœ°å›¾åˆ¶ä½œæŒ‡å—.md](çŸ¿æ´åœ°å›¾åˆ¶ä½œæŒ‡å—.md)**

---

ç¥ä½ æ¸¸æˆå¼€å‘é¡ºåˆ©ï¼â›ï¸ğŸ’
