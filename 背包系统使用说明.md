# 背包系统使用说明

## 概述

为游戏添加了完整的背包系统，玩家可以通过按键 **B** 打开背包界面，查看和管理自己的物品和金币。

## 主要功能

### 1. 背包界面
- **打开方式**: 按下键盘 **B** 键
- **关闭方式**: 按下 **ESC** 或 **B** 键
- **容量**: 30 个槽位（5行 x 6列）

### 2. 初始物品
游戏开始时，背包中会有以下物品：

**工具类** (不可堆叠)
- 锄头 (Hoe) x1
- 浇水壶 (Watering Can) x1
- 镰刀 (Scythe) x1
- 斧头 (Axe) x1
- 镐子 (Pickaxe) x1
- 钓鱼竿 (Fishing Rod) x1

**种子类** (可堆叠，最大99)
- 萝卜种子 (Turnip Seed) x10
- 土豆种子 (Potato Seed) x10
- 玉米种子 (Corn Seed) x5
- 番茄种子 (Tomato Seed) x5
- 南瓜种子 (Pumpkin Seed) x3
- 蓝莓种子 (Blueberry Seed) x3

**材料类** (可堆叠，最大99)
- 木材 (Wood) x20

**初始金币**: 500

### 3. 物品管理

#### 物品显示
- 每个格子显示物品的**颜色图标**和**缩写**
- 右下角显示**数量**（如果大于1）
- 点击格子可以查看物品的**详细信息**

#### 物品颜色编码
- **棕色**: 工具类（锄头、斧头、镐子等）
- **蓝色**: 钓鱼竿
- **绿色**: 种子类
- **橙色/红色/黄色**: 农作物
- **深棕色**: 木材
- **银色**: 鱼

#### 自动收集
当你进行以下操作时，物品会自动添加到背包：
- 砍树掉落木材
- 收获农作物
- 钓鱼获得鱼
- 挖矿获得矿石（如果实现）

### 4. 界面布局

```
┌─────────────────────────────────────┐
│  Inventory                Gold: 500 │
├─────────────────────────────────────┤
│  ┌───┬───┬───┬───┬───┬───┐          │
│  │ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │          │
│  ├───┼───┼───┼───┼───┼───┤          │
│  │ 7 │ 8 │ 9 │10 │11 │12 │          │
│  ├───┼───┼───┼───┼───┼───┤          │
│  │13 │14 │15 │16 │17 │18 │          │
│  ├───┼───┼───┼───┼───┼───┤          │
│  │19 │20 │21 │22 │23 │24 │          │
│  ├───┼───┼───┼───┼───┼───┤          │
│  │25 │26 │27 │28 │29 │30 │          │
│  └───┴───┴───┴───┴───┴───┘          │
├─────────────────────────────────────┤
│  [物品名称 x数量 - 物品描述]        │
└─────────────────────────────────────┘
```

## 技术实现

### 新增文件
1. **InventoryManager.h/cpp** - 背包数据管理
   - 物品存储和数量管理
   - 金币管理
   - 物品添加/移除/查询

2. **InventoryUI.h/cpp** - 背包界面显示
   - 格子渲染
   - 点击交互
   - 动画效果

### 集成到 GameScene
- 在 `GameScene::init()` 中初始化 `InventoryManager`
- 按键 **B** 打开/关闭背包界面
- 物品掉落自动添加到背包
- 背包满时显示提示

### 物品枚举扩展
在 `InventoryManager.h` 中定义了完整的物品类型：

```cpp
enum class ItemType {
    None = -1,
    Hoe, WateringCan, Scythe, Axe, Pickaxe, FishingRod,
    SeedTurnip, SeedPotato, SeedCorn, SeedTomato, SeedPumpkin, SeedBlueberry,
    Wood, Turnip, Potato, Corn, Tomato, Pumpkin, Blueberry, Fish
};
```

## 键盘操作

| 按键 | 功能 |
|------|------|
| **B** | 打开/关闭背包 |
| **ESC** | 关闭背包（或返回菜单） |
| **左键点击** | 选中格子，查看物品信息 |
| **1-0/-/=** | 快速切换工具栏（前12个物品） |

## 编译说明

### 已更新的文件
1. `Classes/InventoryManager.h` - 新增
2. `Classes/InventoryManager.cpp` - 新增
3. `Classes/InventoryUI.h` - 新增
4. `Classes/InventoryUI.cpp` - 新增
5. `Classes/GameScene.h` - 添加背包成员和方法
6. `Classes/GameScene.cpp` - 集成背包系统
7. `CMakeLists.txt` - 添加新文件到编译列表

### 在 Visual Studio 2022 中编译
1. 打开项目解决方案文件
2. 确保配置为 **Debug** 或 **Release**
3. 右键项目 -> **重新生成解决方案**
4. 运行游戏

### 可能遇到的问题

#### 问题1: 编译错误 "找不到文件"
**解决**: 确保 CMakeLists.txt 中正确添加了新文件，重新运行 CMake 生成项目。

#### 问题2: 背包不显示
**解决**: 检查日志输出，确认 `InventoryManager initialized` 和 `Inventory opened` 消息。

#### 问题3: 点击格子无响应
**解决**: 确保背包界面的触摸事件正确设置，检查 `InventoryUI::initSlots()` 中的事件监听器。

## 未来扩展建议

### 1. 物品图标资源
目前使用颜色占位符，建议添加实际的物品图标：
- 在 `Resources/items/` 目录下添加 PNG 图标
- 修改 `InventoryUI::createItemIcon()` 使用真实图片

### 2. 拖拽功能
允许玩家拖拽物品重新排列：
- 实现触摸移动监听
- 添加拖拽视觉反馈
- 实现物品交换逻辑

### 3. 物品使用
在背包中直接使用物品：
- 右键点击使用工具
- 食用食物恢复体力
- 丢弃不需要的物品

### 4. 物品分类标签
添加分类过滤：
- "全部" / "工具" / "种子" / "材料" / "农作物"
- 方便玩家快速查找物品

### 5. 存档系统
将背包数据保存到本地：
- 使用 JSON 或 XML 格式
- 在游戏启动时加载
- 退出时保存

## 代码示例

### 添加物品到背包
```cpp
// 在任何地方调用
if (inventory_) {
    inventory_->addItem(ItemType::Wood, 5);
}
```

### 检查物品数量
```cpp
if (inventory_->hasItem(ItemType::SeedTurnip, 1)) {
    // 有足够的种子
}
```

### 移除物品
```cpp
inventory_->removeItem(ItemType::SeedTurnip, 1);
```

### 管理金币
```cpp
inventory_->addMoney(100);      // 获得金币
inventory_->removeMoney(50);    // 花费金币
int gold = inventory_->getMoney();  // 查询金币
```

## 测试建议

1. **打开背包**: 按 B 键，确认界面正常显示
2. **砍树测试**: 砍倒一棵树，检查木材是否添加到背包
3. **满背包测试**: 添加物品直到背包满，确认提示正常
4. **金币显示**: 检查金币数量是否正确显示
5. **关闭动画**: 测试 ESC 和 B 键关闭效果

## 总结

背包系统已经完全集成到游戏中，包含了基础的物品管理功能。系统设计遵循了项目现有的架构模式，代码结构清晰，易于扩展。玩家现在可以方便地查看和管理自己的物品和金币了！
