# 矿洞系统使用说明

## ✅ 已完成的功能

1. **场景切换**
   - 在农场场景中按 **M 键** 进入矿洞
   - 在矿洞场景中按 **ESC 键** 返回农场

2. **矿洞地图**
   - 使用了新的星露谷物语原版地图资源
   - 地图位置：`Resources/map/Mines/`
   - 当前加载第 1 层地图：`1.tmx`

3. **玩家移动**
   - 使用 **WASD 键** 在矿洞中移动
   - 自动碰撞检测（不能穿过墙壁）
   - 摄像机平滑跟随玩家

4. **共享背包系统**
   - 农场和矿洞共享同一个背包
   - 物品在两个场景间保持一致

## 📁 新地图文件结构

新的矿洞地图使用了不同的图层命名方式：

```
矿洞地图 (Mines/1.tmx)
├── Back 层        - 地面/背景
├── Buildings 层   - 建筑/障碍物 (用作碰撞层)
└── Front 层       - 前景/装饰
```

## 🔧 技术实现

### 修改的文件

1. **MapLayer.cpp**
   - 更新了碰撞层检测逻辑
   - 现在同时支持 "Collision" 层（农场地图）和 "Buildings" 层（矿洞地图）

2. **MineLayer.h/cpp**
   - 简化为只继承 MapLayer 的基础功能
   - 去除了矿物和楼梯相关功能（后续可添加）

3. **MineScene.h/cpp**
   - 简化版矿洞场景
   - 只包含基础的地图显示、玩家移动和场景切换
   - 去除了挖矿和楼梯功能（后续可添加）

4. **GameScene.cpp**
   - 添加了 M 键监听
   - 实现了 `enterMine()` 函数用于场景切换

5. **1.tmx**（矿洞地图文件）
   - 修改了 tileset 图片引用从 "mine" 改为 "mine.png"

6. **CMakeLists.txt**
   - 移除了 MiningManager（暂时不需要挖矿功能）

## 🎮 当前操作方式

### 农场场景
- **WASD** - 移动
- **J** - 使用工具
- **K** - 浇水
- **B** - 打开/关闭背包
- **M** - 进入矿洞 ⭐
- **ESC** - 返回主菜单

### 矿洞场景
- **WASD** - 移动
- **ESC** - 返回农场 ⭐

## 📝 下一步可添加的功能

当您准备添加更多功能时，可以考虑：

1. **多层矿洞**
   - 添加楼梯系统
   - 在楼梯位置按 Enter 进入下一层
   - 已有地图文件：1.tmx 到 60.tmx

2. **挖矿系统**
   - 重新启用 MiningManager
   - 添加矿物层处理
   - 实现挖矿动作

3. **怪物系统**
   - 添加敌人
   - 战斗系统

4. **宝箱和奖励**
   - 特殊物品
   - 矿石收集

## 🐛 注意事项

1. 地图文件必须放在 `Resources/map/Mines/` 文件夹中
2. tileset 图片（mine.png 等）必须和地图文件在同一目录
3. 如果要加载不同层数的地图，只需修改 `GameScene::enterMine()` 中传递的楼层参数

## ✨ 编译成功

项目已成功编译，可以直接运行游戏测试矿洞系统！
